/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/m/p13n/Engine'],function(E){"use strict";var x={};var c=function(C){if(!C._bWaitForModificationChanges&&C.isA){C._bWaitForModificationChanges=true;sap.m.p13n.Engine.getInstance().waitForChanges(C).then(function(){delete C._bWaitForModificationChanges;sap.m.p13n.Engine.getInstance().fireStateChange(C);});}};var q=function(C,t){var f=function(p){if(C._pQueue===p){delete C._pQueue;}};C._pQueue=C._pQueue instanceof Promise?C._pQueue.then(t):t();C._pQueue.then(f.bind(null,C._pQueue));return C._pQueue;};x.createHandler=function(m){if(!m||!m.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!");}var a=m.property;var A;return{"changeHandler":{applyChange:function(C,o,p){return q(o,function(){return sap.m.p13n.Engine.getInstance().readXConfig(o,{propertyBag:p}).then(function(P){var O=C.getChangeType().indexOf("add")>-1?"add":"remove";O=C.getChangeType().indexOf("move")===0?"move":O;A=C.getContent().targetAggregation;var s=O!=="add";if(P&&P.aggregations&&P.aggregations[A]&&P.aggregations[A][C.getContent().key]&&P.aggregations[A][C.getContent().key][a]){s=P.aggregations[A][C.getContent().key][a];}C.setRevertData({key:C.getContent().key,value:s});var b={property:a,key:C.getContent().key,value:C.getContent(),operation:O,propertyBag:p};if(m.aggregationBased){b.controlMeta={aggregation:A};}return sap.m.p13n.Engine.getInstance().enhanceXConfig(o,b);}).then(function(){c(o);});});},completeChangeContent:function(C,b,p){},revertChange:function(C,o,p){var O=C.getChangeType().indexOf("add")>-1?"remove":"add";O=C.getChangeType().indexOf("move")===0?"move":O;A=C.getContent().targetAggregation;var b={controlMeta:{aggregation:A,property:a},property:a,operation:O,key:C.getRevertData().key,value:C.getRevertData(),propertyBag:p};if(m.aggregationBased){b.controlMeta={aggregation:A};}return sap.m.p13n.Engine.getInstance().enhanceXConfig(o,b).then(function(){C.resetRevertData();c(o);});}},"layers":{"USER":true}};};return x;});
