/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/m/p13n/SelectionController','sap/m/p13n/SortPanel','sap/m/p13n/modules/xConfigAPI'],function(B,S,x){"use strict";var a=B.extend("sap.m.p13n.SortController",{constructor:function(){B.apply(this,arguments);this._bResetEnabled=true;}});a.prototype.getStateKey=function(){return"sorters";};a.prototype.getDelta=function(p){p.deltaAttributes.push("descending");return B.prototype.getDelta.apply(this,arguments);};a.prototype.initAdaptationUI=function(p){var s;s=new S();var A=this.mixInfoAndState(p);s.setP13nData(A.items);this._oPanel=s;return Promise.resolve(s);};a.prototype.model2State=function(){var i=[];if(this._oPanel){this._oPanel.getP13nData(true).forEach(function(I){if(I.sorted){i.push({key:I.key});}});return i;}};a.prototype.getChangeOperations=function(){return{add:"addSort",remove:"removeSort"};};a.prototype.getCurrentState=function(e){var X=x.readConfig(this.getAdaptationControl())||{};var s=X.hasOwnProperty("properties")?X.properties.sortConditions:[];return s||[];};a.prototype._createAddRemoveChange=function(c,o,C){var A={selectorElement:c,changeSpecificData:{changeType:o,content:C}};return A;};a.prototype._createMoveChange=function(i,p,n,m,c,P){var M={selectorElement:c,changeSpecificData:{changeType:m,content:{id:i,key:p,index:n}}};if(!P){delete M.changeSpecificData.content.id;}return M;};a.prototype._getPresenceAttribute=function(b){return"sorted";};a.prototype.mixInfoAndState=function(p){var i=this.getCurrentState();var e=this.arrayToMap(i);var P=this.prepareAdaptationData(p,function(I,o){var E=e[o.key];I.sorted=E?true:false;I.sortPosition=E?E.position:-1;I.descending=E?!!E.descending:false;return!(o.sortable===false);});this.sortP13nData({visible:"sorted",position:"sortPosition"},P.items);P.presenceAttribute=this._getPresenceAttribute();P.items.forEach(function(I){delete I.sortPosition;});return P;};return a;});
